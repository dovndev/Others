<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Random-image</title>
    <style type="text/css" media="all">
      * {
        margin: 0px;
        padding: 0px;
      }
      body {
        height: 100%;
        width: 100%;
        background-color: #019EFF;
        display: flex;
        justify-content: center;
        flex-direction: column;
        text-align: center;
        color: white;
      }
      h2 {
        margin-top: 50%;
        text-align: center;
        color: white;
      }
      .children {
        width: 100%;
        max-width: 700px;
        min-height: 100px;
        border-radius: 10px;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        margin-bottom: 20px;
        font-size: 20px;
        font-family: sans-serif;
        text-align: center;
        padding: 10px 0px;
        color: white;
        border-top: 1px solid #DADADA;
        border-bottom: 1px solid #DADADA;
      }
      button {
        width: 80%;
        margin: 10%;
        height: 50px;
      }
      .img {
        width: 50%;
        display: flex;
        margin-top: 10px;
        margin-bottom: 10px;
      }
      div:nth-child(5) div {
        display: block;
        margin-top: 10px;
        margin-bottom: 10px;
      }
      div:nth-child(5) div {
        display: flex;
        justify-content: space-around;
        align-items: center;
        width: 100%;
      }
      div:nth-child(5) div img {
        height: 30px;
      }
    </style>
</head>

<body id="root">
  
</body>
<script>
  let container = document.getElementById('root');
  let countrys;
  let IP;
  let time = new Date().toString().slice(15, -30);
  let data;
  let error = '';
  let html = '';
  let timedisplay;
  const updatetime = () => {
    time = new Date().toString().slice(15, -30);
    timedisplay.innerText = time;
  }
  async function getdetails() {
    try {
      const apilink1 = `http://ipwhois.app/json/${IP}`;
      let response1 = await fetch(apilink1);
      let newdata1 = await response1.json();
      data = await newdata1;
    }catch(err) {
      error = err.message;
      updatehtml('error');
    }
    const apilink2 = 'countrys.json';
    fetch(apilink2).then(response2 => {
      return response2.json();
    }).then(newdata2 => {
      return newdata2.result;
    }).then(countrysdata => {
      countrys = countrysdata;
      return 'ok';
    }).then(ok => {
      updatehtml('success');
      return ok;
    }).then(ok => {
      timedisplay = document.getElementById('timedisplay');
      setInterval(updatetime, 1000);
    }).catch(err => {
      error = err.message;
      updatehtml('error');
    })
  }
  const start = async () => {
    const apilink = "https://api.ipify.org?format=json";
    fetch(apilink).then(response => {
      return response.json();
    }).then(newdata => {
      IP = newdata.ip;
      getdetails();
    }).catch(err => {
      error = err.message;
      updatehtml('error');
    })
  }
  const updatehtml = (status) => {
    if (status == 'loading') {
      console.log(status);
      html = '<h2>Loading...</h2>';
      container.innerHTML = html;
    }else if (status == 'error') {
      console.log(status);
      if (error == 'Failed to fetch') {
        error = 'Unable to access your data';
      }else {
        return;
      }
      html = '<h2>' + error + '</h2>';
      container.innerHTML = html;
    }else {
      console.log(status);
      html = `
        <div class="children">Your IP address is : ${data.ip}<br /><br />type : ${data.type}
        </div>
        <div class="children">Your continent is : ${data.continent}<br /><br />code : ${data.continent_code}
        </div>
        <div class="children">Your Country is : ${data.country}<br /><br />country-capital : ${data.country_capital}
          <img class="img" src="${data.country_flag}" alt="${data.country}" />
          <span>code : ${data.country_code}</span>
        </div>
        <div class="children">Your region is : ${data.region}
        </div>
        <div class="children">Naighbouring country's
          ${
            data.country_neighbours.split(',').map((code) => {
            return `
            <div>
              <p>${countrys.find((country) => {
                return country.code == code;
                }).name + ': ' + code}
              </p>
              <img src="https://cdn.ipwhois.io/flags/${code.toLowerCase()}.svg" alt="" />
            </div>
            `;
            })
          }
        </div>
        <div class="children">Country phone : ${data.country_phone}
        </div>
        <div class="children">Your Service provider is : ${data.isp}
        </div>
        <div class="children">Your currency is : ${data.currency}<br /><br />currency-plural : ${data.currency_plural}<br /><br />currency-code : ${data.currency_code}<br /><br />currency-symbol : ${data.currency_symbol}<br /><br />currency-rate : ${data.currency_rates}
        </div>
        <div class="children">Your time is : <strong id="timedisplay">${time}</strong><br /><br />Time-Zone-name : ${data.timezone_name}<br /><br />Time-Zone-GMT : ${data.timezone_gmt}<br /><br />Time-Zone ${data.timezone}
        </div>
      `;
      container.innerHTML = html;
    }
  }
  start();
  updatehtml('loading');
 </script>
</html>